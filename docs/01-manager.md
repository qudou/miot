# 管理后台

本章节通过介绍管理后台的使用，概要地说明如何建立平台应用。这里并不涉及更具体的细节，详细内容将由后续章节逐个展开。

## 概览

登录用户界面后，可以看到如下的七个与应用管理相关的模块。这些模块本身作为平台应用内置于系统。下面的图示描述了这些模块之间的彼此依赖关系。

<pre>
                +----------+
                |          |
                | 区域管理 |
                |          |
                +----+-----+
                     |
                     v
+----------+    +----+-----+    +----------+
|          |    |          |    |          |
| 用户管理 |    | 网关管理 |    | 系统状态 |
|          |    |          |    |          |
+----+-----+    +----+-----+    +----------+
     |               |
     v               v
+----+-----+    +----+-----+    +----------+
|          |    |          |    |          |
| 授权管理 | <--+ 应用管理 | <--+ 视图管理 |
|          |    |          |    | 　       |
+----------+    +----------+    +----------+
</pre>

对比上一章节，发现该图缺少了中间件管理模块。实际上，由于中间件所使用的标识符与视图所使用的标识符是一致的，所以也就没有必要在后台添加一个与中间件相关的管理模块了。

从图中可以看出，要创建一个平台应用，可以分为四步走：

1. 注册依赖模块，包括与目标应用相关的区域、网关、视图以及中间件等。
2. 注册应用的目标用户
3. 根据注册好的依赖模块，在应用管理模块中注册一个平台应用
4. 将注册好的平台应用授权给目标客户

在上述步骤中，如果创建的应用只是管理员自己使用，步骤 2 和步骤 4 都可以忽略。

## 区域管理

区域是网关的上一层级。在该管理模块内可以对区域进行注册、修改或者删除。如下图所示：

<img src="https://xmlplus.cn/img/miot/area.png" class="img-responsive"/>

要注册一个区域，请点击上图所示页面的注册按钮，即可进入注册页面。要修改或者删除区域，请将目标区域向左滑动，即可看到修改和删除的操作按钮。

区域名称可以任意修改，但删除区域时需要小心，删除区域会连带删除其下一级的网关以及网关下面的所有应用。

## 网关管理

网关是平台应用的上一层级。在该管理模块内可以对区域进行注册、修改或者删除。如下图所示：

<img src="https://xmlplus.cn/img/miot/link.png" class="img-responsive"/>

要注册一个网关，请点击上图所示页面的注册按钮，即可进入注册页面。要修改或者删除区域，请将目标区域向左滑动，即可看到修改和删除的操作按钮。

与区域不同，网关注册或者修改时都需要提供该网关所属的区域，如下图所示：

<img src="https://xmlplus.cn/img/miot/link-update.png" class="img-responsive"/>

另一个与区域不同的地方在于：网关存在状态属性(离线或者在线)。如果有客户端(内网网关)以该网关标识符连接至该系统(外网网关)，则该网关处于在线状态，否则该网关处于离线状态。下图是当网关离线时的提示，即在网关名后显示一个星号，当网关在线时则没有此提示。

<img src="https://xmlplus.cn/img/miot/link-offline.png" class="img-responsive"/>

## 视图管理

视图是平台应用的组成部分，在该管理模块内可以对视图进行注册、修改或者删除。如下图所示：

<img src="https://xmlplus.cn/img/miot/view.png" class="img-responsive"/>

视图由视图名称和标识符组成，这两个成份都可以修改的，但要确保标识符是唯一的。该标识符在注册平台应用时需要用到。

注意，为安全起见，在管理模块内对视图进行注册、修改或者删除并不会在视图层目录创建、修改或者删除真实的视图文件。

## 用户管理

下图是用户管理页面。在该管理模块内可以对用户进行注册、修改或者删除。

<img src="https://xmlplus.cn/img/miot/user.png" class="img-responsive"/>

系统默认内置一管理员用户，其默认用户名是 admin，密码是 123456。对于管理员用户只能修改且不能删除。

## 应用管理

当平台应用的依赖全部建立好之后，就可以开始着手创建平台应用。该模块的主页面如下所示。

<img src="https://xmlplus.cn/img/miot/app-main.png" class="img-responsive"/>

主页面列出了所有区域旗下的所有网关，想注册、修改或者删除应用，需要点开目标网关。下面是一个示例页面。

<img src="https://xmlplus.cn/img/miot/app-manager.png" class="img-responsive"/>

对于上面介绍的其它管理模块，应用管理包含更丰富的内容。我们现在打开注册应用的页面：

<img src="https://xmlplus.cn/img/miot/app-signup.png" class="img-responsive"/>

请看注册页面的类型选项，这里把平台应用分为两种类型，含配件的以及不含配件的。它们之间的区别在于，含配件的应用存在在线和离线两种状态。当平台与服务端的之间未断开连接时，不含配件的应用一直都是在线的，反映到桌面图标就是，前者离线时图标处于灰色状态，在线时图标处于高亮状态。而含配件的应图标则一直以高亮显示。

我们现在再打开平台应用的修改页面：

<img src="https://xmlplus.cn/img/miot/app-update.png" class="img-responsive"/>

从上图中还可以看到，每一个平台应用都包含一个应用标识符，它是不可修改的。另外，我们还可以看到一个叫配件标识符的项目。每创建一个平台应用，都会自动生成一个可修改的配件标识符。配件标识符用于唯一标识一个配件，在创建配件时需要用到。

## 授权管理

建立了用户以及平台应用后，就可以对平台应用进行授权。该模块的主页面如下所示：

<img src="https://xmlplus.cn/img/miot/auth-main.png" class="img-responsive"/>

授权步骤如下：

首先，选择需要授权的用户(页面的第一选项)。

其次，点开目标网关。下面是某一网关点开后的页面：

<img src="https://xmlplus.cn/img/miot/auth-auth.png" class="img-responsive"/>

最后，将要授权的平台应用勾上或者对不想授权的平台应用取消勾选即可。

## 系统状态

该模块与平台应用无直接关系，但通过该模块可以查看与系统相关的运行信息。下面是一个系统状态截图：

<img src="https://xmlplus.cn/img/miot/status.png" class="img-responsive"/>

