# 局域网关

局域网关是连接网内配件与外网网关的桥梁，同时也是局域网内配件之间通信的媒介。

## 安装

如果你已经安装了 npm 客户端，可以通过 npm 安装局域网关程序 miot-local：

```bash
$ npm install miot-local
```

或者，你也可以通过 git 和 npm 使用如下的命令来安装：

```bash
$ git clone https://github.com/qudou/miot-local.git && cd miot-local && npm install
```

## 配置文件

局域网关项目中最关键的是下面两个文件：

```
miot-local/
├── miot-local.js            // 主文件
└── config.json              // 配置文件
```

主文件是启动文件，在此着重对配置文件做些说明，下面是配置文件的一个示例：

```json
{
    port: 1883,                                                             // 提供给内网配件的连接端口
    server: "mqtt://localhost:1883",                                        // 连接到的外网网关的服务地址
    client_id: "62cf572e-7c2a-4b87-96c6-a531cc5890ff",                      // 连接到外网网关的客户端标识符
    parts: [
        { "id": "d9ae5656-9e5e-4991-b4e4-343897a11f28", "path": "/system" },// 连接到内网网关的配件描述
        { "id": "35e64bc0-1268-477a-9327-94e880e67866", "path": "/player" } // 连接到内网网关的配件描述
    ]
}
```

如同 [概述](/miot/overview) 章节中所述，局域网关内置了一个用于连接至外网网关的 MQTT 客户端。上述的 server 以及 client_id 即用于此目的。注意 `client_id` 必须已经在外网网关已经注册过的，否则连接将被拒绝。

配件描述中的 `id` 是配件的唯一标识符，对于任何连接进网关的配件，系统都会对该标识符进行核实，只有配置文件中存在的配件标识符配件，才允许被接入。另外，如果想在外网访问该配件，请确保该标识符在外网网关已注册过。

配件描述中的 `path` 参数的描述方式类似于操作系统的文件定位描述。与配件标识符类似，请确保网内各配件的该参数值互不相同。该参数存在的目的在于方便网内配件之间的访问控制，在下一章节中将看到具体的使用示例。